<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installation Guide</title>
    <style>
        :root {
            --bg-primary: #1a1b26;
            --bg-secondary: #24283b;
            --text-primary: #a9b1d6;
            --text-secondary: #787c99;
            --accent-primary: #7aa2f7;
            --accent-secondary: #449dab;
            --code-bg: #1f2335;
            --code-border: #292e42;
            --success: #9ece6a;
            --link: #73daca;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .code-block {
            position: relative;
            background: var(--code-bg);
            border: 1px solid var(--code-border);
            border-radius: 8px;
            padding: 1.2em;
            margin: 1.5em 0;
            overflow-x: auto;
        }

        .copy-button {
            position: absolute;
            top: 0.8em;
            right: 0.8em;
            padding: 0.5em 1em;
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.9em;
        }

        .code-block:hover .copy-button {
            opacity: 1;
        }

        .copy-button:hover {
            transform: translateY(-1px);
            background: var(--accent-secondary);
        }

        .copy-feedback {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: var(--bg-primary);
            padding: 10px 20px;
            border-radius: 6px;
            display: none;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: 'Fira Code', 'Cascadia Code', Consolas, monospace;
            font-size: 0.95em;
        }

        code {
            font-family: inherit;
            color: #e0af68;
        }

        h1, h2, h3 { 
            margin-top: 1.5em;
            color: #fff;
            font-weight: 600;
        }

        h1 { font-size: 2em; margin-bottom: 0.8em; }
        h2 { font-size: 1.5em; margin-bottom: 0.6em; }
        h3 { font-size: 1.2em; margin-bottom: 0.4em; }

        p { margin: 1em 0; }

        #markup-content {
            display: none;
        }

        :not(pre) > code {
            background: var(--code-bg);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div id="markup-content">
# VCPE Installation Guide

## Prerequisites

Ubuntu 20.04 is known to work.

Ubuntu >= 22.04, optionally switch nftables back to iptables:

```bash
sudo update-alternatives --set iptables /usr/sbin/iptables-legacy
sudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy
```

sudo without password prompts is preferred

## (re-) Install LXD from snap

```bash
sudo snap remove lxd --purge
sudo snap install lxd
sudo snap refresh lxd --channel=6.1/stable
lxd init --auto
lxd version
```

Add your user to the LXD group:

```bash
sudo usermod -a -G lxd $USER
newgrp lxd
```

Verify installation:

```bash
lxc --version
lxc list
```

Run a container test:

```bash
lxc launch images:alpine/edge edge
lxc exec edge -- ping google.com -c 3
lxc delete edge -f
```


## Install meta-lxd


Clone the repo:

```bash
cd
mkdir git
cd git
git clone ssh://git@bitbucket.upc.biz:7999/~rvogelaar/meta-lxd.git
```

Add meta-lxd to System PATH


```bash
vi ~/.bashrc
export PATH="$HOME/git/meta-lxd/probes/scripts:$PATH"
export PATH="$HOME/git/meta-lxd/gen:$PATH"
source ~/.bashrc
```

## Install VCPE bridges

Run the bridges.sh script:

```bash
bridges.sh
```

## Install ACS container

Run the acs.sh script:

```bash
acs.sh
```

## Install BNG containers

Run the bng.sh script to install bng-7, bng-9, and bng-20:

Note: The first step involves creating a BNG base container. This is a one-time process that will take several minutes to complete, as it builds the container from scratch. Please be patient during this initial setup.

```bash
bng.sh 7
bng.sh 9
bng.sh 20
```

## Install CPE containers

Run the mv.sh script to install mv1 container to work with bng-7 (no vlan):

```bash
mv.sh https://vcpe-images.vcpe.dev/mv1-r21.rootfs 7
```

Run the mv.sh script to install mv2plus container to work with bng-7 (no vlan):

```bash
mv.sh https://vcpe-images.vcpe.dev/mv2plus-r21.rootfs 7
```

Run the mv.sh script to install mv3 container to work with bng-9 (multi vlan):

```bash
mv.sh https://vcpe-images.vcpe.dev/mv3-r21.rootfs
```


Run the mv.sh script to install a second mv3 container to work with bng-20 (single vlan):

```bash
mv.sh https://vcpe-images.vcpe.dev/mv3-r21.rootfs 20 001
```


## Configure the CPE containers

on each container run a factory default and set customer id on the containers to match with the bng. Do this by shell into the container.


## Install lan client containers


## Container management exercises:



    </div>

    <div id="output"></div>
    <div class="copy-feedback">Copied to clipboard!</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script>
        function renderContent() {
            const input = document.getElementById('markup-content').textContent;
            const output = document.getElementById('output');
            
            marked.setOptions({
                highlight: function(code) {
                    return code;
                }
            });

            let html = marked.parse(input);

            html = html.replace(
                /<pre><code([^>]*)>([\s\S]*?)<\/code><\/pre>/g,
                '<div class="code-block"><button class="copy-button">Copy</button><pre><code$1>$2</code></pre></div>'
            );

            output.innerHTML = html;

            document.querySelectorAll('.copy-button').forEach(button => {
                button.addEventListener('click', function() {
                    const codeBlock = this.nextElementSibling.querySelector('code');
                    navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                        showCopyFeedback();
                    });
                });
            });
        }

        function showCopyFeedback() {
            const feedback = document.querySelector('.copy-feedback');
            feedback.style.display = 'block';
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 2000);
        }

        document.addEventListener('DOMContentLoaded', renderContent);
    </script>
</body>
</html>